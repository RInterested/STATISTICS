---
output: 
  html_document:
    css: custom.css
---

<br>
<a href="http://rinterested.github.io/statistics/index.html">
<img HEIGHT="20" WIDTH="80" src="https://cloud.githubusercontent.com/assets/9312897/10556783/a27a26fa-745c-11e5-9b1a-2d5bd737387a.PNG"></a>
<br><br>

###TIME SERIES WITH VTI:
<br>

>The [Vanguard Total Stock Market ETF (NYSEARCA: VTI)](http://www.investopedia.com/articles/investing/122315/vti-vanguard-total-stock-market-etf.asp) tracks the performance of the [CRSP U.S. Total Market Index](http://www.crsp.com/products/investment-products/crsp-us-total-market-index). The fund has returned 6.23% since its inception in 2001. The fund is a market capitalization-weighted index that measures the entire investable U.S. equities market. It includes small-, mid- and large-cap companies. The fund is managed in a passive manner and uses an index-sampling strategy.


```{r, warning=F, message=F, fig.height=3, fig.width=5}
library(quantmod)
require(RCurl)
require(foreign)
x <- getURL("https://raw.githubusercontent.com/RInterested/datasets/gh-pages/VTI%20historical%20data.csv")
VTI <- read.csv(text = x, sep =",")
VTI$Date <- as.Date(VTI$Date, format = "%Y-%m-%d")
rownames(VTI) <- VTI$Date
VTI$Date <- NULL                   # Removing the Date column
VTI <- as.xts(VTI)
chartSeries(VTI, type="auto", theme=chartTheme('white'))
```

Notice the [split of the shares](https://www.splithistory.com/vti/) reflected as the broad band on the left of the plot:

>Vanguard Total Stock Market ETF (VTI) has 1 split in our VTI split history database. The split for VTI took place on June 18, 2008. This was a 2 for 1 split, meaning for each share of VTI owned pre-split, the shareholder now owned 2 shares.

---

#####How much can the VTI shares oscillate from day to day?

```{r}
z = as.data.frame(VTI$Adj.Close)    # Subsetting closing price

# Function to calculate % change in closing price between days:
D2D = function (x) {              
  days = nrow(x)
  delta = numeric(days)
  for(i in 2:days){
    delta[i] <- (100*((x[i,1] - x[i - 1,1])/(x[i - 1,1])))
  }
  delta
}
VTI$InterDay = D2D(z)               # Included as add'l column to VTI.

head(VTI$InterDay)                  # A zero in entry 1 spells trouble...
#... we need something to fill in the 0 in row 1. Why not the 2nd  value?
VTI$InterDay[1]<-VTI$InterDay[2]

summary(VTI$InterDay)
```

So the maximum loss between days has been $-9.4\%$, and the maximum gain $12.8\%$. When did these events occur?

```{r}
time(VTI)[VTI$InterDay == min(VTI$InterDay)]
time(VTI)[which.max(VTI$InterDay)]
```

... both during the financial crisis of 2008.

How often does a drop of say, $-4\%$ occurs?

```{r}
sum(VTI$InterDay < -4)
mean(VTI$InterDay < -4) * 100 # or 0.7% of the days
sum(VTI$InterDay < -4) / 16   # or between 1 and 2 days every year.
```

... and what about gains of $4\%$?

```{r}
sum(VTI$InterDay > 4)
mean(VTI$InterDay > 4) * 100 # or 0.6% of the days
sum(VTI$InterDay > 4) / 16   # or between 1 and 2 days every year?
```

But they can't be distributed uniformly... Let's first look at the losses...

```{r, fig.height=5, fig.width=7}
plot(time(VTI), VTI$InterDay < -4, col=2, type='h', xaxt="n",
     xlab="Year", ylab="Days with > - 4% change", 
     cex.axis=.5, cex.main=.8, cex.lab =.5,las=2, 
     main  = "Clustering of big drop days")

tt = time(VTI)
ix = seq(1, nrow(VTI), by = 365 - 2*4*12)
fmt = "%Y"
labs = format(tt, fmt) # Generate the vector of your labels
axis(side = 1, at = tt[ix], labels = labs[ix], cex.axis = 0.7, las = 2)
```

... and the wins...

```{r, fig.height=5, fig.width=7}
plot(time(VTI), VTI$InterDay > 4, col=3, type='h', xaxt="n",
     xlab="Year", ylab="Days with > 4% gains", 
     cex.axis=.5, cex.main=.8, cex.lab =.5,las=2, 
     main  = "Clustering of big winning days")

tt = time(VTI)
ix = seq(1, nrow(VTI), by = 365 - 2*4*12)
fmt = "%Y"
labs = format(tt, fmt) # Generate the vector of your labels
axis(side = 1, at = tt[ix], labels = labs[ix], cex.axis = 0.7, las = 2)
```

Wow! Huge spike around 2008 - 2009. [How much clustering is there](https://s3.amazonaws.com/assets.datacamp.com/blog_assets/xts_Cheat_Sheet_R.pdf)?

```{r}
sum(VTI["2008/2009"]$InterDay < - 4) # Total number of drops > -4%
# As a percentage of all losing days...
sum(VTI["2008/2009"]$InterDay < - 4) / sum(VTI$InterDay < -4) 
```

What about wins during the same period?

```{r}
sum(VTI["2008/2009"]$InterDay >  4) # Total number of drops > -4%
# As a percentage of all winning days...
sum(VTI["2008/2009"]$InterDay >  4) / sum(VTI$InterDay > 4)
```

So, during the crisis there were $22$ "big losing" days, and $15$ "big winning days". Yet, the market tanked. Were the losing days worse, not just more numerous?

The maximum drop did occur during the crisis...

```{r}
min(VTI["2008/2009"]$InterDay)
```

a whopping $9\%$! As compared to the maximum inter-day win

```{r}
max(VTI["2008/2009"]$InterDay)
```

Wow! When did it happen?

```{r}
time(VTI["2008/2009"])[which.max(VTI["2008/2009"]$InterDay)]
VTI["2008-10-13"]
```

---

Finally, let's take a look at the fat tails of VTI as representative of the market, and as compared to the normal distribution:

```{r}
hist(VTI$InterDay,main="INTERDAY VTI % CHANGES: FAT TAILS",sub="fitted normal (in purple); pdf estimate (in blue)",xlab = "PERCENTAGE CHANGE FROM DAY TO DAY",
     ylab = "FREQUENCY", prob = TRUE, col ="coral", ylim=c(0,0.5),
     xlim=c(-4,4), cex.main=.9, cex.sub=.8, cex.lab=.7, border=F,
     breaks = 33)

#Add density estimate
lines(density(VTI$InterDay,adjust=7),col="darkred",lwd=2) #Prettier, adjusted pdf estimate
sd = sd(VTI$InterDay)
m = mean(VTI$InterDay)
curve(dnorm(x,mean=m,sd=sd),col="grey60",lwd=2,add=T,yaxt="n")
lines(density(VTI$InterDay,adjust=7),col="darkred",lwd=2) #Prettier, adjusted pdf estimate

```

---

<a href="http://rinterested.github.io/statistics/index.html">Home Page</a>
