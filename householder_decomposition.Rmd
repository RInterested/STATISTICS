---
title: 'Householder transformation'
output: 
  html_document:
    theme: readable
    includes:
      in_header: "favicon.html" 
    css: custom.css
---

### **NOTES ON STATISTICS, PROBABILITY and MATHEMATICS**

<a href="http://rinterested.github.io/statistics/index.html">
<img HEIGHT="40" WIDTH="50" src="logo.PNG"></a>

---

### Householder Transformation:

---

From [here](https://www.r-bloggers.com/2017/04/qr-decomposition-with-householder-reflections/):

> The more common approach to QR decomposition is employing Householder reflections rather than utilizing Gram-Schmidt. In practice, the Gram-Schmidt procedure is not recommended as it can lead to cancellation that causes inaccuracy of the computation of $q_j,$ which may result in a non-orthogonal $Q$ matrix. 

---

#### Mathematical Concepts:

---

<img width = 400  src = "https://raw.githubusercontent.com/RInterested/statistics/gh-pages/Householder.png">

The projection of $\vec x$ on $\vec u$ (unit vector perpendicular to the plane) is a scalar multiple of $\vec u$, we find that $\vec w = \vec u \, \alpha$. It follows that $0 = \vec u^T\,(\vec x - \vec w) = \vec u^T\,(\vec x - \vec u\,\alpha)$. Therefore,

$$\alpha = \frac{\vec u^T \vec x}{\vec u^T \vec u}$$

And substituting,

$$\vec w = \vec u \, \alpha = \frac{\vec u\,\vec u^T}{\vec u^T \vec u} \vec x$$

Since $\vec u$ is of unit length, 

$$\vec w = \vec u\,\vec u^T  \, \vec x = \vec u^T \vec x \vec u$$

as on the diagram above. And the reflection of $\vec x$ is:

$$\vec y = \vec x -  2\,\vec w\\ = \vec x  -2\,\vec u^T \vec x \, \vec u \\= \vec x  -2\,  \vec u \vec u^T \vec x \\= (I - 2\,  \vec u \vec u^T)\,\vec x$$

with the matrix $H = I - 2\,\vec u \vec u^T$ being the mirror or reflection matrix (aka a Householder transformation).

A YT presentation on this topic can be found [here](https://youtu.be/6TIVIw4B5VA?si=9v5Yclrm05TmIsPc).

Since we want to get an upper-triangular matrix $R$ in the intended $QR$ decomposition, the computation is carried out by successive sub-matrices such as in each one, the first column is of the form $\begin{bmatrix}a_1,0,0,\cdots\end{bmatrix}^\top$. Since the $H$ matrix is orthonormal, the transformation exerted by $H\vec x$ leaves the norm of $\vec x$ unchanged.


---

#### Computation:

---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

---

```{r}
House <- function(A) {
  require(Matrix)
  
  R <- as.matrix(A) # Set R to the input matrix A
  
  n <- ncol(A)
  m <- nrow(A)
  H <- list() # Initialize a list to store the computed H matrices to calculate Q later
  
  if (m > n) {
    c <- n
  } else {
    c <- m
  }
  
  for (k in 1:c) {
    x <- R[k:m,k] # Equivalent to a_1
    print(c(x[1], sign(x[1])))
    e <- as.matrix(c(1, rep(0, length(x)-1)))
    vk <- sign(x[1]) * sqrt(sum(x^2)) * e + x
    print(vk)
    # Compute the H matrix
    hk <- diag(length(x)) - 2 * as.vector(vk %*% t(vk)) / (t(vk) %*% vk)
    print(c("k equals",k))
    print(hk)
    if (k > 1) {
      hk <- bdiag(diag(k-1), hk)
      print(hk)
    }
    
    # Store the H matrix to find Q at the end of iteration
    H[[k]] <- hk
    
    R <- hk %*% R
  }

  Q <- Reduce("%*%", H) # Calculate Q matrix by multiplying all H matrices
  res <- list('Q'=Q,'R'=R)
  return(res)
}
```



```{R}
A <- rbind(c(2,-2,18),c(2,1,0),c(1,2,0))
House(A)
```



---
<a href="http://rinterested.github.io/statistics/index.html">Home Page</a>

**NOTE: These are tentative notes on different topics for personal use - expect mistakes and misunderstandings.**
