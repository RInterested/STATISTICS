---
title: 'Poisson Regression'
output: 
  html_document:
    theme: readable
    includes:
      in_header: "favicon.html" 
    css: custom.css
---

### **NOTES ON STATISTICS, PROBABILITY and MATHEMATICS**

<a href="http://rinterested.github.io/statistics/index.html">
<img HEIGHT="40" WIDTH="50" src="logo.PNG"></a>

---

#### Interrupted time series regression for the evaluation of public health interventions:

from [here](https://academic.oup.com/ije/article/46/1/348/2622842?login=false).

> The interrupted time series (ITS) study design is increasingly being used for the evaluation of public health interventions; it is particularly suited to interventions introduced at a population level over a clearly defined time period and that target population-level health outcomes. 
>
> ITS has been used for the evaluation of a wide range of public health interventions including new vaccines, cycle helmet legislation, changes to paracetamol packaging, traffic speed zones and precautions against nosocomial infections, as well as in the evaluation of health impacts of unplanned events such as the global financial crisis.
>
> In standard ITS analyses, the following segmented regression model is used:
>
$$Y_t=β_0 +β_1T+β_2X_t + β_3TX_t$$ 
>
> where $β_0$ represents the baseline level at $T = 0,$ $β_1$ is interpreted as the change in outcome associated with a time unit increase (representing the underlying pre-intervention trend), $β_2$ is the level change following the intervention and $β_3$ indicates the slope change following the intervention (using the interaction between time and intervention: $TX_t$⁠).

The model above corresponds to impact mode $(c):$

![](https://user-images.githubusercontent.com/9312897/172089433-cedf193f-bad2-486b-8d88-8d1da3784160.png)

---

models $(a)$ and $(b)$ can easily be specified by excluding the terms $β_3TX_t$  or $β_2 X_t⁠$, respectively.The other models require slightly more complex variable specifications.

---

From [this site](https://clelandcm.github.io/ITS/):

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```

```{R}
library(curl)
library(lmtest)
library(vcd)
library(Epi)
library(tsModel)
library(splines)
library(tidyverse)
```

In the dataset `sicily` `aces` = count of acute coronary episodes in Sicily per month (the outcome) and `smokban` = smoking ban (the intervention) coded 0 before intervention. `time` = elapsed time since the start of the study. `pop` = the population of Sicily (in 10000s). `stdpop` = age standardised population

```{R}
data <- read.csv('https://raw.githubusercontent.com/RInterested/DATASETS/gh-pages/sicily.csv')
head(data)
```

---

#### Descriptive analysis:

Examining the data is an important first step. Looking at the pre-intervention trend can give an indication of how stable the trend is over time, whether a linear model is likely to be appropriate, and whether there appears to be a seasonal trend.

```{R}
data$rate <- with(data, aces/stdpop*10^5)

plot(data$rate,type="n",ylim=c(00,300),xlab="Year", ylab="Std rate x 10,000", bty="l",xaxt="n")
rect(36,0,60,300,col=grey(0.9),border=F)
points(data$rate[data$smokban==0],cex=0.7)
axis(1,at=0:5*12,labels=F)
axis(1,at=0:4*12+6,tick=F,labels=2002:2006)
title("Sicily, 2002-2006")

# Summary statistics:
data %>%
  gather(Variable, Value) %>%
  group_by(Variable) %>%
  summarize(n = n(),
            Mean = mean(Value),
            SD = sd(Value),
            Median = median(Value),
            IQR = IQR(Value),
            Min = min(Value),
            Max = max(Value)) %>%
  knitr::kable()

# Statistics before and after smoking ban:
data %>%
  mutate(Period = case_when(smokban == 0 ~ "1. Before Ban",
                            smokban == 1 ~ "2. After Ban")) %>%
  select(Period, aces, rate) %>%
  gather(Variable, Value, -Period) %>%
  group_by(Period, Variable) %>%
    summarize(n = n(),
            Mean = mean(Value),
            SD = sd(Value),
            Median = median(Value),
            IQR = IQR(Value),
            Min = min(Value),
            Max = max(Value)) %>%
  knitr::kable()
```

---

#### Poisson Regression Model:

We model the count data directly (rather than the rate which doesn’t follow a Poisson distribution), using the population (log transformed) as an offset variable in order to transform back to rates.

```{R}
model1 <- glm(aces ~ offset(log(stdpop)) + smokban + time, family=poisson, data)
summary(model1)
round(ci.lin(model1,Exp=T),3)
```

#### Predicting future values:

```{R}
datanew <- data.frame(stdpop = mean(data$stdpop),
                      smokban = rep(c(0, 1), c(360, 240)),
                      time = 1:600/10,
                      month = rep(1:120/10, 5))

pred1 <- predict(model1, type="response", datanew) / mean(data$stdpop) * 10^5

plot(data$rate, type="n", ylim=c(0,300), xlab="Year", ylab="Std rate x 10,000", bty="l", xaxt="n")
rect(36, 0, 60, 300, col=grey(0.9), border=F)
points(data$rate,cex=0.7)
axis(1, at=0:5*12, labels=F)
axis(1, at=0:4*12+6, tick=F, labels=2002:2006)
lines((1:600/10), pred1, col=2)
title("Sicily, 2002-2006")
```

---
<a href="http://rinterested.github.io/statistics/index.html">Home Page</a>

**NOTE: These are tentative notes on different topics for personal use - expect mistakes and misunderstandings.**
